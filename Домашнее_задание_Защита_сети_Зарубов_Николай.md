# Домашнее задание к занятию «Защита сети»

**Студент:** Зарубов Николай  
**Дата выполнения:** 12 октября 2025 г.  
**Тема:** Настройка и тестирование систем обнаружения вторжений (IDS/IPS) и предотвращения атак

---

## Цель работы

Изучить принципы работы систем обнаружения и предотвращения вторжений на примере Suricata и Fail2Ban, провести практическое тестирование их эффективности против различных типов сетевых атак.

## Теоретическая часть

### Системы обнаружения вторжений (IDS)
- **Suricata** - открытая система обнаружения вторжений нового поколения (NGIDS)
- Функции: анализ сетевого трафика, обнаружение аномалий, генерация алертов
- Режимы работы: IDS (обнаружение) и IPS (предотвращение)

### Системы предотвращения атак
- **Fail2Ban** - система предотвращения вторжений на основе анализа логов
- Функции: мониторинг логов сервисов, автоматическая блокировка подозрительных IP
- Принцип работы: анализ логов → обнаружение паттернов атак → применение контрмер

## Практическая часть

### Подготовка лабораторной среды

#### Защищаемая система
- **ОС:** Ubuntu 22.04.5 LTS
- **IP-адрес:** 10.128.0.8
- **Установленные компоненты:**
  - Suricata 6.0.4 (IDS/IPS)
  - Fail2Ban 0.11.2 (защита от брутфорс атак)
  - SSH сервер (OpenSSH 8.9p1)

#### Система злоумышленника
- **Инструменты:**
  - nmap 7.80 (сетевой сканер)
  - hydra 9.2 (инструмент для брутфорс атак)

### Задание 1: Разведка системы

#### Цель
Провести разведку защищаемой системы с помощью различных методов сканирования nmap и проанализировать реакцию систем защиты.

#### Выполненные команды

**1. TCP ACK scan (-sA)**
```bash
sudo nmap -sA 10.128.0.8
```
```
Starting Nmap 7.80 ( https://nmap.org ) at 2025-10-12 07:34 UTC
Nmap scan report for test.ru-central1.internal (10.128.0.8)
Host is up (0.0000050s latency).
All 1000 scanned ports on test.ru-central1.internal (10.128.0.8) are unfiltered

Nmap done: 1 IP address (1 host up) scanned in 0.08 seconds
```

**2. TCP connect scan (-sT)**
```bash
sudo nmap -sT 10.128.0.8
```
```
Starting Nmap 7.80 ( https://nmap.org ) at 2025-10-12 07:34 UTC
Nmap scan report for test.ru-central1.internal (10.128.0.8)
Host is up (0.000079s latency).
Not shown: 999 closed ports
PORT   STATE SERVICE
22/tcp open  ssh

Nmap done: 1 IP address (1 host up) scanned in 0.04 seconds
```

**3. TCP SYN scan (-sS)**
```bash
sudo nmap -sS 10.128.0.8
```
```
Starting Nmap 7.80 ( https://nmap.org ) at 2025-10-12 07:34 UTC
Nmap scan report for test.ru-central1.internal (10.128.0.8)
Host is up (0.0000080s latency).
Not shown: 999 closed ports
PORT   STATE SERVICE
22/tcp open  ssh

Nmap done: 1 IP address (1 host up) scanned in 0.13 seconds
```

**4. Version detection scan (-sV)**
```bash
sudo nmap -sV 10.128.0.8
```
```
Starting Nmap 7.80 ( https://nmap.org ) at 2025-10-12 07:34 UTC
Nmap scan report for test.ru-central1.internal (10.128.0.8)
Host is up (0.0000050s latency).
Not shown: 999 closed ports
PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.13 (Ubuntu Linux; protocol 2.0)
Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 0.56 seconds
```

#### Анализ результатов разведки

**Реакция систем защиты:**

**Suricata:**
- Логи пусты - сканирование nmap не было обнаружено как атака
- Причина: правила по умолчанию не настроены для обнаружения портового сканирования

**Fail2Ban:**
- Обнаружены исторические попытки атак на SSH от внешних IP-адресов:
  - 209.14.2.218 (2025-10-12 07:27:46)
  - 2.57.121.112 (2025-10-12 07:30:20)
  - 77.91.82.170 (2025-10-12 07:32:26)
  - 103.93.201.42 (2025-10-12 07:34:07)

**Обнаруженные службы:**
- SSH (порт 22/tcp) - OpenSSH 8.9p1 Ubuntu 3ubuntu0.13
- Операционная система: Linux

### Задание 2: Атака на подбор пароля SSH

#### Цель
Провести атаку на подбор пароля для службы SSH и проанализировать эффективность защиты Fail2Ban.

#### Подготовка атаки

**Файл users.txt:**
```
msfadmin
root
admin
user
test
administrator
guest
ubuntu
```

**Файл pass.txt:**
```
password
123456
admin
root
msfadmin
test
password123
letmein
qwerty
12345
```

#### Выполнение атаки

**Попытка атаки с hydra:**
```bash
hydra -L users.txt -P pass.txt 10.128.0.8 ssh
```

Результат: Атака не удалась из-за настроек SSH (только ключевая аутентификация)

**Симуляция атаки:**
Создан скрипт для имитации множественных попыток подключения:

```bash
#!/bin/bash
for i in {1..15}; do
    echo "Попытка $i..."
    timeout 3 ssh -o ConnectTimeout=2 -o StrictHostKeyChecking=no \
        -o UserKnownHostsFile=/dev/null -o PasswordAuthentication=yes \
        -l attacker 10.128.0.8 "exit" 2>/dev/null || true
    sleep 1
done
```

#### Анализ логов после атаки

**Логи SSH (/var/log/auth.log):**
```
Oct 12 07:36:25 test sshd[5828]: Invalid user attacker from 10.128.0.8 port 54382
Oct 12 07:36:25 test sshd[5828]: Connection closed by invalid user attacker 10.128.0.8 port 54382 [preauth]
Oct 12 07:36:26 test sshd[5839]: Invalid user attacker from 10.128.0.8 port 48570
Oct 12 07:36:26 test sshd[5839]: Connection closed by invalid user attacker 10.128.0.8 port 48570 [preauth]
Oct 12 07:36:27 test sshd[5846]: Invalid user attacker from 10.128.0.8 port 48576
Oct 12 07:36:27 test sshd[5846]: Connection closed by invalid user attacker 10.128.0.8 port 48576 [preauth]
Oct 12 07:36:28 test sshd[5858]: Invalid user attacker from 10.128.0.8 port 48588
Oct 12 07:36:28 test sshd[5858]: Connection closed by invalid user attacker 10.128.0.8 port 48588 [preauth]
```

**Логи Fail2Ban (/var/log/fail2ban.log):**
```
2025-10-12 07:36:23,922 fail2ban.filter [4535]: INFO [sshd] Found 10.128.0.8 - 2025-10-12 07:36:23
2025-10-12 07:36:25,009 fail2ban.filter [4535]: INFO [sshd] Found 10.128.0.8 - 2025-10-12 07:36:25
2025-10-12 07:36:26,096 fail2ban.filter [4535]: INFO [sshd] Found 10.128.0.8 - 2025-10-12 07:36:26
2025-10-12 07:36:27,189 fail2ban.filter [4535]: INFO [sshd] Found 10.128.0.8 - 2025-10-12 07:36:27
2025-10-12 07:36:28,321 fail2ban.filter [4535]: INFO [sshd] Found 10.128.0.8 - 2025-10-12 07:36:28
2025-10-12 07:36:28,701 fail2ban.actions [4535]: NOTICE [sshd] Ban 10.128.0.8
```

**Статус Fail2Ban после атаки:**
```
Status for the jail: sshd
|- Filter
|  |- Currently failed: 4
|  |- Total failed: 9
|  `- File list: /var/log/auth.log
`- Actions
   |- Currently banned: 1
   |- Total banned: 1
   `- Banned IP list: 10.128.0.8
```

## Анализ результатов

### Эффективность систем защиты

#### Fail2Ban - отличная эффективность
- ✅ Быстро обнаружил подозрительную активность (5 попыток за 5 секунд)
- ✅ Корректно применил блокировку IP-адреса после превышения лимита
- ✅ Настройки по умолчанию оказались адекватными (5 попыток за 10 минут, блокировка на 10 минут)
- ✅ Зафиксировал исторические попытки атак от внешних IP-адресов

#### Suricata - требует дополнительной настройки
- ❌ Не обнаружил nmap сканирование как подозрительную активность
- ❌ Не зафиксировал SSH атаки в логах
- ⚠️ Необходимо обновить правила и настроить фильтры для обнаружения атак

#### SSH сервер - корректная работа
- ✅ Все попытки подключения корректно записаны в auth.log
- ✅ Информация в логах достаточна для анализа Fail2Ban
- ✅ Защита от атак с несуществующими пользователями работает

### Сравнение методов сканирования

| Тип сканирования | Обнаруженные порты | Время выполнения | Обнаружение IDS |
|------------------|-------------------|------------------|-----------------|
| TCP ACK (-sA)    | Все unfiltered    | 0.08 сек         | Нет             |
| TCP Connect (-sT)| SSH (22)          | 0.04 сек         | Нет             |
| TCP SYN (-sS)    | SSH (22)          | 0.13 сек         | Нет             |
| Version (-sV)    | SSH + версия      | 0.56 сек         | Нет             |

## Выводы

### Основные результаты
1. **Fail2Ban** показал высокую эффективность в защите от брутфорс атак на SSH
2. **Suricata** требует дополнительной настройки для полной функциональности
3. Различные методы сканирования nmap дали разные результаты по скорости и информативности
4. SSH сервер корректно логировал все события для анализа системами защиты

### Практические рекомендации

#### Улучшение Suricata
1. Обновить правила: `sudo suricata-update`
2. Настроить правила для обнаружения портового сканирования
3. Добавить правила для SSH атак и брутфорс попыток
4. Настроить режим IPS для активного блокирования атак

#### Ужесточение Fail2Ban
1. Уменьшить количество попыток с 5 до 3
2. Увеличить время блокировки с 10 до 60 минут
3. Добавить дополнительные фильтры для других служб
4. Настроить уведомления администратора

#### Общая безопасность
1. Отключить аутентификацию по паролю SSH, использовать только ключи
2. Настроить мониторинг и алерты для критических событий
3. Регулярно обновлять правила IDS/IPS
4. Внедрить многоуровневую защиту (файрвол + IDS + WAF)

### Заключение
Лабораторная работа успешно продемонстрировала принципы работы систем обнаружения и предотвращения вторжений. Fail2Ban показал отличную эффективность в защите от брутфорс атак, в то время как Suricata требует дополнительной настройки для полной функциональности. Полученные знания позволяют понять важность многоуровневой защиты сети и необходимость регулярного обновления правил безопасности.

---

**Студент:** Зарубов Николай  
**Дата:** 12 октября 2025 г.  
**Преподаватель:** [ФИО преподавателя]
