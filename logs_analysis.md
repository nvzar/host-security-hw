# Анализ логов систем безопасности

## Сводка по заданиям

### Задание 1: Разведка системы с помощью nmap

#### Выполненные сканирования:

1. **TCP ACK scan (-sA)**
   - Команда: `sudo nmap -sA 10.128.0.8`
   - Результат: Все порты показаны как "unfiltered"
   - Цель: Определение состояния фильтрации пакетов

2. **TCP connect scan (-sT)**
   - Команда: `sudo nmap -sT 10.128.0.8`
   - Результат: Обнаружен порт 22/tcp (SSH)
   - Цель: Полное TCP-подключение для определения открытых портов

3. **TCP SYN scan (-sS)**
   - Команда: `sudo nmap -sS 10.128.0.8`
   - Результат: Обнаружен порт 22/tcp (SSH)
   - Цель: Скрытое сканирование без завершения соединения

4. **Version detection scan (-sV)**
   - Команда: `sudo nmap -sV 10.128.0.8`
   - Результат: SSH OpenSSH 8.9p1 Ubuntu 3ubuntu0.13
   - Цель: Определение версий служб и операционной системы

#### Анализ логов после разведки:

**Suricata (IDS):**
- Логи пусты - сканирование не было классифицировано как атака
- Возможные причины:
  - Правила не настроены для обнаружения nmap сканирования
  - Сканирование было недостаточно агрессивным для срабатывания
  - Правила Suricata требуют дополнительной настройки

**Fail2Ban:**
- Обнаружены исторические попытки атак от внешних IP:
  - 209.14.2.218 (2025-10-12 07:27:46)
  - 2.57.121.112 (2025-10-12 07:30:20)
  - 77.91.82.170 (2025-10-12 07:32:26)
  - 103.93.201.42 (2025-10-12 07:34:07)

### Задание 2: Атака на подбор пароля SSH

#### Подготовка атаки:

**Файл users.txt:**
```
msfadmin
root
admin
user
test
administrator
guest
ubuntu
```

**Файл pass.txt:**
```
password
123456
admin
root
msfadmin
test
password123
letmein
qwerty
12345
```

#### Попытка атаки с hydra:
- Команда: `hydra -L users.txt -P pass.txt 10.128.0.8 ssh`
- Результат: Ошибка "does not support password authentication"
- Причина: SSH настроен только на ключевую аутентификацию

#### Симуляция атаки:
Создан скрипт `simulate_attack.sh` для имитации брутфорс атаки:
- 15 попыток подключения с несуществующим пользователем "attacker"
- Интервал между попытками: 1 секунда
- Таймаут подключения: 3 секунды

#### Детальный анализ логов:

**Логи SSH (/var/log/auth.log):**
```
Oct 12 07:36:25 test sshd[5828]: Invalid user attacker from 10.128.0.8 port 54382
Oct 12 07:36:25 test sshd[5828]: Connection closed by invalid user attacker 10.128.0.8 port 54382 [preauth]
Oct 12 07:36:26 test sshd[5839]: Invalid user attacker from 10.128.0.8 port 48570
Oct 12 07:36:26 test sshd[5839]: Connection closed by invalid user attacker 10.128.0.8 port 48570 [preauth]
Oct 12 07:36:27 test sshd[5846]: Invalid user attacker from 10.128.0.8 port 48576
Oct 12 07:36:27 test sshd[5846]: Connection closed by invalid user attacker 10.128.0.8 port 48576 [preauth]
Oct 12 07:36:28 test sshd[5858]: Invalid user attacker from 10.128.0.8 port 48588
Oct 12 07:36:28 test sshd[5858]: Connection closed by invalid user attacker 10.128.0.8 port 48588 [preauth]
```

**Логи Fail2Ban (/var/log/fail2ban.log):**
```
2025-10-12 07:36:23,922 fail2ban.filter [4535]: INFO [sshd] Found 10.128.0.8 - 2025-10-12 07:36:23
2025-10-12 07:36:25,009 fail2ban.filter [4535]: INFO [sshd] Found 10.128.0.8 - 2025-10-12 07:36:25
2025-10-12 07:36:26,096 fail2ban.filter [4535]: INFO [sshd] Found 10.128.0.8 - 2025-10-12 07:36:26
2025-10-12 07:36:27,189 fail2ban.filter [4535]: INFO [sshd] Found 10.128.0.8 - 2025-10-12 07:36:27
2025-10-12 07:36:28,321 fail2ban.filter [4535]: INFO [sshd] Found 10.128.0.8 - 2025-10-12 07:36:28
2025-10-12 07:36:28,701 fail2ban.actions [4535]: NOTICE [sshd] Ban 10.128.0.8
```

**Статус Fail2Ban после атаки:**
```
Status for the jail: sshd
|- Filter
|  |- Currently failed: 4
|  |- Total failed: 9
|  `- File list: /var/log/auth.log
`- Actions
   |- Currently banned: 1
   |- Total banned: 1
   `- Banned IP list: 10.128.0.8
```

## Выводы и рекомендации

### Эффективность систем защиты:

1. **Fail2Ban** - показал отличную эффективность:
   - Быстро обнаружил подозрительную активность
   - Корректно применил блокировку после превышения лимита попыток
   - Настройки по умолчанию оказались адекватными (5 попыток за 10 минут)

2. **Suricata** - требует дополнительной настройки:
   - Не обнаружил nmap сканирование
   - Не зафиксировал SSH атаки
   - Необходимо обновить правила и настройки

3. **SSH сервер** - корректно логировал события:
   - Все попытки подключения записаны в auth.log
   - Информация достаточна для анализа Fail2Ban

### Рекомендации по улучшению:

1. **Настройка Suricata:**
   - Обновить правила: `sudo suricata-update`
   - Настроить правила для обнаружения портового сканирования
   - Добавить правила для SSH атак

2. **Ужесточение Fail2Ban:**
   - Уменьшить количество попыток с 5 до 3
   - Увеличить время блокировки с 10 до 60 минут
   - Добавить дополнительные фильтры

3. **Общая безопасность:**
   - Отключить аутентификацию по паролю SSH
   - Использовать только ключевую аутентификацию
   - Настроить мониторинг и алерты
   - Регулярно обновлять правила IDS/IPS

### Заключение:
Лабораторная работа успешно продемонстрировала работу систем обнаружения и предотвращения атак. Fail2Ban показал высокую эффективность в защите от брутфорс атак на SSH, в то время как Suricata требует дополнительной настройки для полной функциональности.
